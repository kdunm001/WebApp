{% extends 'core/base.html' %}
{% load static %}


{% block title %}Timesheet | {% endblock title %}

{% block content %}
    <!-- Load Google Maps API in the head -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

    <script>
        // Initialize the map
        let map;

        async function initMap() {
            const { Map } = await google.maps.importLibrary("maps");

            map = new Map(document.getElementById("map"), {
                center: { lat: 1, lng: 1 },
                zoom: 13,
                mapId: '4bb9e065fd60ba4'
            });

            // Get user's current location and update map
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        // Center the map on the user's location
                        map.setCenter(userLocation);

                        // Create a marker for the user's location

                        new google.maps.Marker({
                            position: userLocation,
                            map: map,
                            icon: '{% static 'images/arrow.png' %}',
                            title: "Your Location",
                        });
                    },
                    function (error) {
                        console.error(`Error getting location: ${error.message}`);
                    }
                );
            } else {
                console.error("Geolocation is not supported by this browser.");
            }

            // Add markers for each location passed from the Django view
            {% for location in locations %}
                new google.maps.Marker({
                    position: { lat: {{ location.latitude }}, lng: {{ location.longitude }} },
                    map: map,
                    title: "{{ location.name }}",
                });
            {% endfor %}
        }

        initMap();
    </script>

    <div class="bg-gray-100 p-8">
        <div class="max-w-md mx-auto bg-white rounded p-6 shadow-md">
            <form method="POST">
                {% csrf_token %}
                <button type="submit" name="clock_in" value="clock_in" class="mt-0 flex flex-wrap w-full mb-1 flex-col items-center text-center text-white bg-green-500 border-0 py-2 px-6 focus:outline-none hover:bg-green-600 rounded text-lg">Clock In</button>
            </form>

            <div id="map" style="height: 60vh; width: 100%"></div>
            <script async src="https://maps.googleapis.com/maps/api/js?key={{ key }}&callback=initMap"></script>

        </div>
    </div>
{% endblock content %}